<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Leaflet + OSRM útvonaltervező</title>

    <!-- Leaflet CSS -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #info {
            padding: 10px;
            background: #f5f5f5;
            border-bottom: 1px solid #ccc;
            font-size: 15px;
        }

        /* A fontos rész! */
        #map {
            height: calc(100vh - 60px);
            width: 100%;
        }
    </style>
</head>
<body>

<div id="info">
    Kattints a térképre waypoint hozzáadásához.
</div>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // --- Alaptérkép ---
    const map = L.map('map').setView([47.4979, 19.0402], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];
    let routeLine = null;

    // --- Kattintás: waypoint hozzáadása ---
    map.on('click', (e) => {
        addWaypoint(e.latlng);
        drawRoute();
    });

    function addWaypoint(latlng) {
        const marker = L.marker(latlng, { draggable: true }).addTo(map);

        marker.bindPopup(`Waypoint #${markers.length + 1}`);

        // Mozgatás után számolunk új útvonalat
        marker.on('dragend', () => {
            drawRoute();
        });

        markers.push(marker);
    }

    // --- OSRM útvonal rajzolása ---
    async function drawRoute() {
        if (markers.length < 2) return;

        const coords = markers
            .map(m => m.getLatLng())
            .map(p => `${p.lng},${p.lat}`)
            .join(";");

        const url = `https://router.project-osrm.org/route/v1/driving/${coords}?overview=full&geometries=geojson&steps=true`;

        const res = await fetch(url);
        const data = await res.json();

        if (!data.routes || !data.routes.length) {
            document.getElementById("info").innerHTML = "Nincs elérhető útvonal!";
            return;
        }

        const route = data.routes[0];

        // GeoJSON → Leaflet
        const latlngs = route.geometry.coordinates.map(c => [c[1], c[0]]);

        if (routeLine) map.removeLayer(routeLine);

        routeLine = L.polyline(latlngs, {
            color: 'blue',
            weight: 5
        }).addTo(map);

        map.fitBounds(routeLine.getBounds());

        showInfo(route.distance, route.duration);
    }

    function showInfo(distance, duration) {
        const km = (distance / 1000).toFixed(2);
        const min = Math.round(duration / 60);

        document.getElementById("info").innerHTML =
            `<b>Útvonal hossza:</b> ${km} km<br>
             <b>Menetidő:</b> ${min} perc<br>
             <small>Kattints új waypointokhoz, vagy húzd a meglévőket!</small>`;
    }
</script>

</body>
</html>
